<<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Reconocimiento de voz</title>
  </head>
  <body style="text-align:center; font-family: sans-serif;">
    <h1>ðŸŽ¤ Reconocimiento de voz con Teachable Machine</h1>
    <button type="button" onclick="init()">Iniciar</button>
    <div id="label-container" style="margin-top: 20px;"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>

    <script type="text/javascript">
      const URL = "./my_model/";

      async function createModel() {
        const checkpointURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        const recognizer = speechCommands.create(
          "BROWSER_FFT",
          undefined,
          checkpointURL,
          metadataURL
        );

        await recognizer.ensureModelLoaded();
        return recognizer;
      }

      async function init() {
        const recognizer = await createModel();
        const classLabels = recognizer.wordLabels();
        const labelContainer = document.getElementById("label-container");

        labelContainer.innerHTML = "";
        for (let i = 0; i < classLabels.length; i++) {
          labelContainer.appendChild(document.createElement("div"));
        }

        recognizer.listen(result => {
          const scores = result.scores;
          for (let i = 0; i < classLabels.length; i++) {
            labelContainer.childNodes[i].innerHTML =
              classLabels[i] + ": " + scores[i].toFixed(2);
          }
        }, {
          includeSpectrogram: false,
          probabilityThreshold: 0.75,
          overlapFactor: 0.5
        });
      }
    </script>
  </body>
</html>
